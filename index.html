<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>project: starfall</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ </text></svg>">
<link rel="stylesheet" href="style.css">

<style>
  /* Settings & UI */
  .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
  .settings-card { background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; border: 1px solid #333; }
  .settings-card h3 { margin-top: 0; color: #00d4ff; font-size: 1rem; text-transform: uppercase; }
  .control-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
  
  /* Game Viewport */
  #game-container { display: none; text-align: center; }
  #game-viewport { width: 100%; height: 80vh; border: 2px solid #00d4ff; border-radius: 12px; background: #000; }
  
  /* Buttons */
  .btn-group { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
  .back-btn, .action-btn, .fs-btn { 
    background: #1a1a1a; color: #00d4ff; border: 1px solid #00d4ff; 
    padding: 8px 15px; cursor: pointer; border-radius: 5px; 
    font-family: monospace; transition: 0.3s; 
  }
  .back-btn:hover, .action-btn:hover, .fs-btn:hover { background: #00d4ff; color: #000; box-shadow: 0 0 10px #00d4ff; }
  
  .game-card { cursor: pointer; transition: 0.3s; border: 1px solid #333; padding: 20px; border-radius: 8px; text-align: center; }
  .game-card:hover { border-color: #00d4ff; transform: translateY(-3px); }
</style>
</head>
<body>

<canvas id="stars"></canvas>

<header>
  <h1>project: starfall</h1>
  <nav>
    <a href="#home">Home</a>
    <a href="#play">Play</a>
    <a href="#systems">Systems</a>
    <a href="#about">About</a>
  </nav>
</header>

<main>
  <section id="home" class="page active">
    <h2>Welcome</h2>
    <p>project: starfall is a drifting collection of browser games.</p>
  </section>

  <section id="play" class="page">
    <div id="game-container">
      <div class="btn-group">
        <button class="back-btn" onclick="closeGame()">ðŸ“‚ Return to Archive</button>
        <button class="fs-btn" onclick="requestGameFullscreen()">â›¶ Fullscreen</button>
      </div>
      <iframe id="game-viewport" src="" frameborder="0" allow="fullscreen" allowfullscreen></iframe>
    </div>

    <div id="library">
      <h2>Game Library</h2>
      <div class="game-grid">
        <div class="game-card" onclick="loadGame('games/neon-racer/index.html')">Neon Racer</div>
        <div class="game-card" onclick="loadGame('games/asteroid-avoider/index.html')">Asteroid Avoider</div>
        <div class="game-card" onclick="loadGame('games/cyber-pulse/index.html')">Cyber Pulse</div>
        <div class="game-card" onclick="loadGame('games/star-shifter/index.html')">Star Shifter</div>
        <div class="game-card" onclick="loadGame('games/void-operator/index.html')">Void Operator</div>
      </div>
    </div>
  </section>

  <section id="systems" class="page">
    <h2>System Configuration</h2>
    <div class="settings-grid">
      <div class="settings-card">
        <h3>Performance</h3>
        <div class="control-row">
          <span>Star Density</span>
          <input type="range" id="density-slider" min="50" max="1000" value="300" onchange="updateDensity(this.value)">
        </div>
        <div class="control-row">
          <span>Frame Rate Cap</span>
          <select id="fps-cap" onchange="updateFPS(this.value)">
            <option value="60">60 FPS</option>
            <option value="30">30 FPS</option>
          </select>
        </div>
      </div>
      <div class="settings-card">
        <h3>Visuals</h3>
        <div class="control-row">
          <span>Animate Stars</span>
          <input type="checkbox" id="star-toggle" checked onchange="toggleStars(this.checked)">
        </div>
        <div class="control-row">
          <span>Site Fullscreen</span>
          <button class="action-btn" onclick="toggleSiteFullscreen()">Toggle</button>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
/* --- NAVIGATION --- */
const pages = document.querySelectorAll(".page");
function showPage() {
  const hash = location.hash.replace("#", "") || "home";
  if (hash !== "play") closeGame();
  pages.forEach(p => p.classList.remove("active"));
  const page = document.getElementById(hash);
  if (page) page.classList.add("active");
}
window.addEventListener("hashchange", showPage);
showPage();

/* --- GAME LOGIC --- */
function loadGame(path) {
  const vp = document.getElementById('game-viewport');
  vp.src = path; 
  document.getElementById('library').style.display = 'none';
  document.getElementById('game-container').style.display = 'block';
  window.scrollTo(0, 0);
}

function closeGame() {
  document.getElementById('game-viewport').src = ''; 
  document.getElementById('game-container').style.display = 'none';
  document.getElementById('library').style.display = 'block';
}

// Fullscreen for the Game specifically
function requestGameFullscreen() {
  const gameViewport = document.getElementById('game-viewport');
  if (gameViewport.requestFullscreen) {
    gameViewport.requestFullscreen();
  } else if (gameViewport.webkitRequestFullscreen) { /* Safari */
    gameViewport.webkitRequestFullscreen();
  } else if (gameViewport.msRequestFullscreen) { /* IE11 */
    gameViewport.msRequestFullscreen();
  }
}

// Fullscreen for the whole Website
function toggleSiteFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
}

/* --- STARFIELD ENGINE --- */
let starsMoving = true;
let starCount = 300;
let fpsInterval = 1000 / 60;
let lastDrawTime = Date.now();
const canvas = document.getElementById("stars");
const ctx = canvas.getContext("2d");
let w, h, stars = [];

function updateDensity(val) {
  starCount = parseInt(val);
  initStars();
  localStorage.setItem('starfall_density', val);
}

function updateFPS(val) {
  fpsInterval = 1000 / parseInt(val);
  localStorage.setItem('starfall_fps', val);
}

function toggleStars(val) {
  starsMoving = val;
  localStorage.setItem('starfall_animate', val);
}

function initStars() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
  stars = Array.from({ length: starCount }, () => ({
    x: Math.random() * w,
    y: Math.random() * h,
    speed: Math.random() * 1.5 + 0.2,
    size: Math.random() * 2
  }));
}

function draw() {
  requestAnimationFrame(draw);
  let now = Date.now();
  let elapsed = now - lastDrawTime;
  if (elapsed > fpsInterval) {
    lastDrawTime = now - (elapsed % fpsInterval);
    ctx.clearRect(0, 0, w, h);
    ctx.fillStyle = "white";
    for (const s of stars) {
      ctx.globalAlpha = 0.8;
      ctx.fillRect(s.x, s.y, s.size, s.size);
      if (starsMoving) {
        s.y += s.speed;
        if (s.y > h) s.y = 0;
      }
    }
  }
}

window.onload = () => {
  // Restore Settings
  if(localStorage.getItem('starfall_animate') === 'false') {
    starsMoving = false;
    document.getElementById('star-toggle').checked = false;
  }
  if(localStorage.getItem('starfall_density')) {
    starCount = parseInt(localStorage.getItem('starfall_density'));
    document.getElementById('density-slider').value = starCount;
  }
  if(localStorage.getItem('starfall_fps')) {
    let savedFPS = localStorage.getItem('starfall_fps');
    fpsInterval = 1000 / parseInt(savedFPS);
    document.getElementById('fps-cap').value = savedFPS;
  }
  initStars();
  draw();
};
window.addEventListener("resize", initStars);
</script>

</body>
</html>
