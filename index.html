<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>project: starfall</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ </text></svg>">
<link rel="stylesheet" href="style.css">

<style>
  /* --- UI & Theming --- */
  :root { --neon: #00d4ff; --bg: #050505; }
  
  body { background: var(--bg); color: #fff; overflow-x: hidden; }

  /* Scanline Overlay */
  .scanlines {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
    background-size: 100% 4px, 3px 100%;
    pointer-events: none; z-index: 9999;
  }

  .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
  .settings-card { background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 8px; border: 1px solid #333; }
  .settings-card h3 { margin-top: 0; color: var(--neon); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
  .control-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-family: monospace; }
  
  /* Leaderboard Styling */
  .stats-display { margin-top: 20px; font-family: monospace; border: 1px dashed #444; padding: 15px; border-radius: 8px; }
  .stats-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #222; }
  .stats-row:last-child { border-bottom: none; }
  .stats-label { color: var(--neon); }

  /* Game Viewport */
  #game-container { display: none; text-align: center; }
  #game-viewport { width: 100%; height: 85vh; border: 2px solid var(--neon); border-radius: 12px; background: #000; box-shadow: 0 0 20px rgba(0, 212, 255, 0.2); }
  
  .btn-group { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; }
  .action-btn, .fs-btn, .back-btn { 
    background: #111; color: var(--neon); border: 1px solid var(--neon); 
    padding: 10px 20px; cursor: pointer; border-radius: 4px; font-family: monospace; transition: 0.2s; 
  }
  .action-btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 15px var(--neon); }

  .game-card { 
    background: rgba(0, 212, 255, 0.03); cursor: pointer; transition: 0.3s; 
    border: 1px solid #333; padding: 30px; border-radius: 8px; text-align: center;
    text-transform: uppercase; letter-spacing: 2px; font-weight: bold;
  }
  .game-card:hover { border-color: var(--neon); transform: translateY(-5px); background: rgba(0, 212, 255, 0.1); }
</style>
</head>
<body>

<div class="scanlines"></div>
<canvas id="stars"></canvas>

<header>
  <h1>project: starfall</h1>
  <nav>
    <a href="#home">Home</a>
    <a href="#play">Play</a>
    <a href="#systems">Systems</a>
    <a href="#about">About</a>
  </nav>
</header>

<main>
  <section id="home" class="page active">
    <h2>Welcome, Operator</h2>
    <p>Project Starfall is a synchronized archive of 5 experimental game modules.</p>
    
    <div class="stats-display">
      <h3 style="color: var(--neon); margin-top: 0;">Archive Leaderboard</h3>
      <div id="leaderboard-content">
        </div>
    </div>
  </section>

  <section id="play" class="page">
    <div id="game-container">
      <div class="btn-group">
        <button class="back-btn" onclick="closeGame()">ðŸ“‚ Return to Archive</button>
        <button class="fs-btn" onclick="requestGameFullscreen()">â›¶ Fullscreen Mode</button>
      </div>
      <iframe id="game-viewport" src="" frameborder="0" allow="fullscreen"></iframe>
    </div>

    <div id="library">
      <h2>Game Library</h2>
      <div class="game-grid">
        <div class="game-card" onclick="loadGame('games/neon-racer/index.html')">Neon Racer</div>
        <div class="game-card" onclick="loadGame('games/asteroid-avoider/index.html')">Asteroid Avoider</div>
        <div class="game-card" onclick="loadGame('games/cyber-pulse/index.html')">Cyber Pulse</div>
        <div class="game-card" onclick="loadGame('games/star-shifter/index.html')">Star Shifter</div>
        <div class="game-card" onclick="loadGame('games/void-operator/index.html')">Void Operator</div>
      </div>
    </div>
  </section>

  <section id="systems" class="page">
    <h2>System Configuration</h2>
    <div class="settings-grid">
      <div class="settings-card">
        <h3>Performance</h3>
        <div class="control-row">
          <span>Star Density</span>
          <input type="range" id="density-slider" min="50" max="1000" value="300" onchange="updateDensity(this.value)">
        </div>
        <div class="control-row">
          <span>Star Speed</span>
          <input type="range" id="speed-slider" min="0" max="5" step="0.1" value="1.0" onchange="updateStarSpeed(this.value)">
        </div>
      </div>
      
      <div class="settings-card">
        <h3>Visuals</h3>
        <div class="control-row">
          <span>Star Tint</span>
          <input type="color" id="star-color" value="#ffffff" onchange="updateStarColor(this.value)">
        </div>
        <div class="control-row">
          <span>Animate Stars</span>
          <input type="checkbox" id="star-toggle" checked onchange="toggleStars(this.checked)">
        </div>
      </div>

      <div class="settings-card">
        <h3>Archive Data</h3>
        <div class="control-row">
          <span>Clear All Scores</span>
          <button class="action-btn" style="border-color: #ff4444; color: #ff4444;" onclick="clearScores()">Wipe Data</button>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
/* --- NAVIGATION --- */
const pages = document.querySelectorAll(".page");
function showPage() {
  const hash = location.hash.replace("#", "") || "home";
  if (hash !== "play") closeGame();
  pages.forEach(p => p.classList.remove("active"));
  const page = document.getElementById(hash);
  if (page) page.classList.add("active");
  if (hash === "home") renderLeaderboard();
}
window.addEventListener("hashchange", showPage);

/* --- GAME LOGIC & AUTO-FOCUS --- */
function loadGame(path) {
  const vp = document.getElementById('game-viewport');
  vp.src = path; 
  document.getElementById('library').style.display = 'none';
  document.getElementById('game-container').style.display = 'block';
  
  // FIX: Auto-focus the iframe so controls work instantly
  vp.onload = () => {
    vp.contentWindow.focus();
  };
  window.scrollTo(0, 0);
}

function closeGame() {
  document.getElementById('game-viewport').src = ''; 
  document.getElementById('game-container').style.display = 'none';
  document.getElementById('library').style.display = 'block';
  renderLeaderboard();
}

function requestGameFullscreen() {
  const vp = document.getElementById('game-viewport');
  if (vp.requestFullscreen) vp.requestFullscreen();
}

/* --- LEADERBOARD SYSTEM --- */
const gameNames = ['Neon Racer', 'Asteroid Avoider', 'Cyber Pulse', 'Star Shifter', 'Void Operator'];

function renderLeaderboard() {
  const container = document.getElementById('leaderboard-content');
  container.innerHTML = gameNames.map(name => {
    const score = localStorage.getItem(`high_${name.replace(/\s/g, '')}`) || 0;
    return `
      <div class="stats-row">
        <span class="stats-label">${name}</span>
        <span>${Math.floor(score)}</span>
      </div>
    `;
  }).join('');
}

// Receive score from games: window.parent.postMessage({game: 'NeonRacer', score: 100}, '*')
window.addEventListener('message', (e) => {
  if (e.data.game && e.data.score) {
    const key = `high_${e.data.game}`;
    const currentHigh = localStorage.getItem(key) || 0;
    if (e.data.score > currentHigh) {
      localStorage.setItem(key, e.data.score);
    }
  }
});

function clearScores() {
  if(confirm("Confirm deletion of all archive data?")) {
    gameNames.forEach(n => localStorage.removeItem(`high_${n.replace(/\s/g, '')}`));
    renderLeaderboard();
  }
}

/* --- STARFIELD ENGINE (ADVANCED) --- */
let starsMoving = true;
let starCount = 300;
let starCol = "#ffffff";
let globalStarSpeed = 1.0;
const canvas = document.getElementById("stars");
const ctx = canvas.getContext("2d");
let w, h, stars = [];

function updateDensity(val) { starCount = parseInt(val); initStars(); localStorage.setItem('sf_density', val); }
function updateStarColor(val) { starCol = val; localStorage.setItem('sf_color', val); }
function updateStarSpeed(val) { globalStarSpeed = parseFloat(val); localStorage.setItem('sf_speed', val); }
function toggleStars(val) { starsMoving = val; localStorage.setItem('sf_animate', val); }

function initStars() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
  stars = Array.from({ length: starCount }, () => ({
    x: Math.random() * w,
    y: Math.random() * h,
    speed: (Math.random() * 1.5 + 0.2),
    size: Math.random() * 2
  }));
}

function draw() {
  ctx.clearRect(0, 0, w, h);
  ctx.fillStyle = starCol;
  for (const s of stars) {
    ctx.globalAlpha = 0.8;
    ctx.fillRect(s.x, s.y, s.size, s.size);
    if (starsMoving) {
      s.y += s.speed * globalStarSpeed;
      if (s.y > h) s.y = 0;
    }
  }
  requestAnimationFrame(draw);
}

window.onload = () => {
  if(localStorage.getItem('sf_animate') === 'false') {
    starsMoving = false;
    document.getElementById('star-toggle').checked = false;
  }
  starCount = parseInt(localStorage.getItem('sf_density')) || 300;
  starCol = localStorage.getItem('sf_color') || "#ffffff";
  globalStarSpeed = parseFloat(localStorage.getItem('sf_speed')) || 1.0;
  
  document.getElementById('density-slider').value = starCount;
  document.getElementById('star-color').value = starCol;
  document.getElementById('speed-slider').value = globalStarSpeed;

  initStars();
  draw();
  renderLeaderboard();
};
window.addEventListener("resize", initStars);
</script>
</body>
</html>
