<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classwork</title>
    <link rel="icon" type="image/x-icon" href="https://ssl.gstatic.com/classroom/favicon.png">
    <link rel="stylesheet" href="../assets/css/Classroom.css">
    <style>
        .work-header { border-bottom: 1px solid var(--border-color); padding-bottom: 16px; margin-bottom: 20px; }
        .work-header h1 { font-size: 28px; font-weight: 400; margin: 10px 0; color: var(--brand-color); }
        
        .iframe-wrapper { 
            position: relative; 
            width: 100%; 
            aspect-ratio: 16 / 9; 
            background: #1a1a1a; 
            border-radius: 8px; 
            overflow: hidden; 
            border: 1px solid var(--border-color);
        }

        iframe { width: 100%; height: 100%; border: none; display: none; }

        /* Loading Spinner */
        .loader-container {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center; color: white; font-family: sans-serif;
        }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid var(--brand-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Error Message */
        #error-screen {
            display: none;
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #f8d7da; color: #721c24;
            flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; text-align: center; box-sizing: border-box;
        }

        .back-link { text-decoration: none; color: var(--text-gray); font-size: 14px; display: inline-block; margin-bottom: 20px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="sidebar"><a href="../index.html" class="side-icon">üè†</a></div>
    
    <div class="main-wrapper">
        <div class="view-section">
            <div class="content-container">
                <a class="back-link" onclick="history.back()">‚Üê Back to class stream</a>
                
                <div class="work-header">
                    <h1 id="assignment-title">Loading Assignment...</h1>
                </div>

                <div class="iframe-wrapper">
                    <div id="loading-screen" class="loader-container">
                        <div class="spinner"></div>
                        <p>Opening module...</p>
                    </div>

                    <div id="error-screen">
                        <h2 style="margin-top:0;">‚ö†Ô∏è Assignment Failed to Load</h2>
                        <p id="error-desc">Unknown error occurred.</p>
                        <button onclick="location.reload()" style="margin-top:10px; padding:8px 16px; cursor:pointer;">Retry</button>
                    </div>

                    <iframe id="content-frame" allowfullscreen sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script src="../assets/js/main.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const type = urlParams.get('type');
        const id = urlParams.get('id');
        const movieUrl = urlParams.get('url');
        const name = urlParams.get('name');

        const frame = document.getElementById('content-frame');
        const loader = document.getElementById('loading-screen');
        const errorScreen = document.getElementById('error-screen');
        const errorDesc = document.getElementById('error-desc');

        if (name) document.getElementById('assignment-title').innerText = name;

        // Set the source based on type
        let targetSrc = "";
        if (type === 'game') {
            targetSrc = `../games/${id}/index.html`;
        } else if (type === 'movie') {
            targetSrc = decodeURIComponent(movieUrl);
        }

        // Diagnostic Check 1: Missing Info
        if (!targetSrc) {
            showError("Invalid URL: No content ID or URL provided in the assignment data.");
        } else {
            frame.src = targetSrc;
        }

        // Handle successful load
        frame.onload = function() {
            loader.style.display = 'none';
            frame.style.display = 'block';
        };

        // Diagnostic Check 2: Timeout / Connection Error
        const loadTimeout = setTimeout(() => {
            if (frame.style.display !== 'block') {
                showError("Request Timed Out: The content took too long to respond. This usually happens if the link is dead or blocked by the network.");
            }
        }, 8000); // 8 second timeout

        function showError(msg) {
            clearTimeout(loadTimeout);
            loader.style.display = 'none';
            errorScreen.style.display = 'flex';
            errorDesc.innerText = msg;
        }

        // Diagnostic Check 3: Check for common iframe block issues
        window.addEventListener('message', function(e) {
            // Some providers send messages if they fail to load
            if (e.data === 'error') showError("The provider refused the connection (X-Frame-Options).");
        });
    </script>
</body>
</html>
